name: Actualizar Tasa BCV

on:
  schedule:
    # Ejecutar todos los días a las 12:00 UTC (8:00 AM Venezuela)
    - cron: '0 12 * * *'
  workflow_dispatch: # Permite ejecución manual

jobs:
  actualizar:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout código
      uses: actions/checkout@v4
    
    - name: Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Instalar dependencias
      run: |
        pip install requests beautifulsoup4 pymongo python-dotenv lxml pytz
    
    - name: Ejecutar scraper
      env:
        MONGODB_URI: ${{ secrets.MONGODB_URI }}
        DATABASE_NAME: bcv_api
        COLLECTION_NAME: tasas
      run: |
        python - <<EOF
        from scripts.scraper import BCVScraper
        from scripts.db import MongoDB
        
        scraper = BCVScraper()
        resultado = scraper.obtener_tasa()
        
        if resultado['exito']:
            db = MongoDB()
            db.actualizar_tasa(resultado['valor'], resultado['fecha'])
            db.close()
            print(f"✓ Tasa actualizada: {resultado['valor']} - {resultado['fecha']}")
        else:
            print(f"✗ Error: {resultado['error']}")
            exit(1)
        EOF