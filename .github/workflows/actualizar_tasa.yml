name: Actualizar Tasa BCV

on:
  schedule:
    - cron: '0 8 * * 1-5'
  workflow_dispatch:

jobs:
  actualizar:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout código
      uses: actions/checkout@v4
    
    - name: Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Instalar dependencias
      run: |
        pip install requests beautifulsoup4 pymongo python-dotenv lxml pytz urllib3
    
    - name: Ejecutar scraper
      env:
        MONGODB_URI: ${{ secrets.MONGODB_URI }}
        DATABASE_NAME: bcv_api
        COLLECTION_NAME: tasas
      run: |
        python - <<EOF
        from scripts.scraper import BCVScraper
        from scripts.db import MongoDB
        
        scraper = BCVScraper()
        resultado = scraper.obtener_tasas()
        
        if resultado['exito']:
            db = MongoDB()
            db.actualizar_tasas(resultado['monedas'], resultado['fecha'])
            db.close()
            print(f"✓ Tasas actualizadas para: {resultado['fecha']}")
            print(f"✓ Monedas: {', '.join(resultado['monedas'].keys())}")
        else:
            print(f"✗ Error: {resultado['error']}")
            exit(1)
        EOF